suite: test extra deploy resources
templates:
  - extra-list.yaml
tests:
  - it: should not create any resources by default
    asserts:
      - hasDocuments:
          count: 0

  - it: should render single extra resource
    values:
      - ./values/extradeploy-single.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: extra-configmap

  - it: should render multiple extra resources
    values:
      - ./values/extradeploy-multiple.yaml
    asserts:
      - hasDocuments:
          count: 3

  - it: should render first extra resource correctly
    values:
      - ./values/extradeploy-multiple.yaml
    documentIndex: 0
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: extra-cm-1

  - it: should render second extra resource correctly
    values:
      - ./values/extradeploy-multiple.yaml
    documentIndex: 1
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: extra-secret

  - it: should render third extra resource correctly
    values:
      - ./values/extradeploy-multiple.yaml
    documentIndex: 2
    asserts:
      - isKind:
          of: ServiceAccount
      - equal:
          path: metadata.name
          value: extra-sa
