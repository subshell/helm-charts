# Default values for sophora-importer.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: docker.subshell.com/sophora/sophora-importer
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: "master"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

javaOptions: "-XX:MinRAMPercentage=50.0 -XX:MaxRAMPercentage=90.0"

# - (object) k8s Pod host aliases which will be used to generate the /etc/hosts file
hostAliases:

# -- (bool) If set to true the data will not be imported.
debugMode: false

metrics:
  pushgatewayUrl:
  authentication:
    secret:
      name:
      usernameKey: "username"
      passwordKey: "password"

sophora:
  serverUrl:
  internalConnection: true
  authentication:
    secret:
      name:
      usernameKey: "username"
      passwordKey: "password"

repoDownload:
  zipViaHttp:
    secretName:
    zipUrls:
    usernameKey: "username"
    passwordKey: "password"
    image:
      repository: "docker.subshell.com/misc/alpine-toolkit"
      tag: "0.1.0"
      pullPolicy: IfNotPresent
  zipViaS3:
    secretName:
    s3Endpoint: "https://storage.googleapis.com"
    bucketName:
    zipPaths:
    secretAccessKeyKey: "secretAccessKey"
    accessKeyIdKey: "accessKeyId"
    image:
      repository: "docker.subshell.com/misc/aws-cli-tools"
      tag: "0.0.1"
      pullPolicy: IfNotPresent

processWatcherImage:
  repository: "docker.subshell.com/misc/alpine-toolkit"
  tag: "0.1.0"
  pullPolicy: IfNotPresent

prometheusRule:
  enabled: false
  rules:
    - alert: SophoraImportJobMissedDocuments
      expr: abs(sum by (job) (sophora_import_job_downloaded_documents{job="{{ include "sophora-repo-import.fullname" . }}"}) - sum by(job) (sophora_import_job_imported_documents{imported="true", job="{{ include "sophora-repo-import.fullname" . }}"})) > 0
      labels:
        severity: error
      annotations:
        description: 'Sophora import job ({{ "{{ $labels.job }}" }}) did not import some documents: {{ "{{ $value }}" }} '
        summary: 'The import job downloaded more files than it imported successfully.'
        runbook_url: 'https://bitbucket.org/subshell_gmbh/helm-charts/src/master/charts/sophora-repo-import/latest/alerting-runbook.md'
    - alert: SophoraImportJobDidNotDownloadAnyDocuments
      expr: sophora_import_job_downloaded_documents{job="{{ include "sophora-repo-import.fullname" . }}"} == 0
      labels:
        severity: warning
      annotations:
        description: 'Sophora import job ({{ "{{ $labels.job }}" }}) did not download any documents.'
        summary: 'The import job did not find any documents in the downloaded archives and hence cannot import anything.'
        runbook_url: 'https://bitbucket.org/subshell_gmbh/helm-charts/src/master/charts/sophora-repo-import/latest/alerting-runbook.md'
    - alert: SophoraImportJobFailed
      expr: max(vector(0) or sophora_import_job_end{success="false", job="{{ include "sophora-repo-import.fullname" . }}"}) > max(vector(0) or sophora_import_job_end{success="true", job="{{ include "sophora-repo-import.fullname" . }}"})
      labels:
        severity: critical
      annotations:
        description: 'Sophora import job failed.'
        summary: 'The import job ({{ include "sophora-repo-import.fullname" . }}) did not complete successfully.'
        runbook_url: 'https://bitbucket.org/subshell_gmbh/helm-charts/src/master/charts/sophora-repo-import/latest/alerting-runbook.md'

podAnnotations: {}

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi
