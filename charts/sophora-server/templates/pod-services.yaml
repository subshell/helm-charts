{{- if .Values.clusterReplication.enabled -}}
{{- range $i := until (int $.Values.replicaCount) }}
{{- $service := $.Values.clusterReplication.servicesDefaults -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "sophora-server.fullname" $ }}-{{ $i }}
  labels: {{- include "sophora-server.labels" $ | nindent 4 }}
  {{ if  $service.annotations -}}
  annotations: {{- toYaml $service.annotations | nindent 4 }}
  {{- end }}
spec:
  type: {{ $service.type | quote }}
  publishNotReadyAddresses: {{ $service.publishNotReadyAddresses }}
  selector:
    statefulset.kubernetes.io/pod-name: {{ include "sophora-server.fullname" $ }}-{{ $i }}
  ports:
    - port: {{ $.Values.service.httpPort }}
      targetPort: http
      protocol: TCP
      name: http
    - port: {{ $.Values.service.jmsPort }}
      targetPort: jms
      protocol: TCP
      name: jms

---

{{- end }}
{{- end }}