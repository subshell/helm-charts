{{ if .Values.sophora.server.storage.persistentVolume.create -}}
apiVersion: v1
kind: PersistentVolume
metadata:
  name: sophora-server-storage-{{ include "sophora-server.fullname" . }}-0
spec:
  storageClassName: {{.Values.sophora.server.storage.storageClass }}
  capacity:
    storage: {{.Values.sophora.server.storage.resources.requests.storage }}
  accessModes:
    - ReadWriteOnce
  claimRef:
    kind: PersistentVolumeClaim
    namespace: {{ .Release.Namespace }}
    name: sophora-server-storage-{{ include "sophora-server.fullname" . }}-0
  {{ if .Values.sophora.server.storage.persistentVolume.csi -}}
  csi: {{ toYaml .Values.sophora.server.storage.persistentVolume.csi | nindent 4 }}
  {{- end }}
  {{ if .Values.sophora.server.storage.persistentVolume.nodeAffinity -}}
  nodeAffinity: {{ toYaml .Values.sophora.server.storage.persistentVolume.nodeAffinity | nindent 4 }}
  {{- end }}
{{- end }}